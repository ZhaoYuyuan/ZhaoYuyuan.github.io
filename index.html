<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>index</title>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

</head>

<body>
	<script>
		var video;
var disGlobal=0;

var options = {
  video: {
      facingMode: {
       exact: "environment"
	   //exact: "user"
     }
  }
};

function setup() {
  background(160);
  video = createCapture(options);
  pixelDensity(1);
  textSize(20);
  textAlign(CENTER, CENTER);
  video.hide();
}

function draw() {
  createCanvas(video.width, video.height);
  background(160);
  loadPixels();
  video.loadPixels();
  
  detectColor();
  //fill((r+g+b)/3);
  //rect(x,y,10,10);
  //updatePixels();
  textAlign(CENTER);

  disGlobal=floor(disGlobal/10000 * 255);

  image(video,0,0);
  for(var i=1; i<=3; i++){
	for(var j=1; j<=3; j++){
		noStroke();
		fill(random(disGlobal),random(disGlobal),random(disGlobal));
  		rect(width/4*j-25,height/4*i-25,50,50);
	}
  }
  drawWords(width * 0.95, height * 0.95);
  disGlobal=0;


}

function drawWords(x, y) {
  fill(255);

  text(disGlobal, x, y);
  
}

function detectColor(){
  var dr,dg,db,dis,dx,dy,index,indexLast;
  for(var i= 1; i<=10; i++){
    for(var j= 1; j<=10; j++){
      
      dx= floor(width / 10 * j)-1;
      dy= floor(height / 10 * i)-1;
      index = (dx + dy * width) * 4;
      //console.log(dx);
      //console.log(dy);
      //console.log(index);
      if(i==1 && j==1){
        dr= video.pixels[index + 0] - 128;
        dg= video.pixels[index + 1] - 128;
        db= video.pixels[index + 2] - 128;
        //console.log(dr);
      }else{
        //console.log(indexLast);
        dr= video.pixels[index + 0] - video.pixels[indexLast + 0];
        dg= video.pixels[index + 1] - video.pixels[indexLast + 1];
        db= video.pixels[index + 2] - video.pixels[indexLast + 2];
        //console.log(dr);
      }
      dis = Math.sqrt(Math.pow(dr,2)+Math.pow(dg,2)+Math.pow(db,2));
	  
      dis = floor(dis);
	  //console.log(dis);
      disGlobal += dis;
      indexLast=index;
	  
    }
  }
}

	</script>
</body>

</html>
